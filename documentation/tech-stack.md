# Tech Stack

## Overview

Pet Medical is a full-stack web application: a Go API backend with a React single-page application (SPA) frontend, designed to run as a single Docker service with an embedded frontend and a separate PostgreSQL database.

## Backend

| Layer | Technology | Notes |
|-------|------------|--------|
| Language | Go 1.21+ | |
| Router | Gorilla Mux | HTTP routing and path params |
| ORM | GORM | Migrations (AutoMigrate), all DB access |
| Database | PostgreSQL 16 | Persistent data |
| Auth | JWT (access) + refresh tokens | Access in cookie + optional `Authorization: Bearer`; refresh in httpOnly cookie |
| Config | Environment variables | See [README](../README.md#configuration) and `docker-compose.sample.yml` |
| Middleware | Auth (JWT/cookie), CORS, throttle (rate limit by client IP), logging | Rate limits configurable per auth vs general API |
| Upload limits | Photos, documents | Max sizes configurable via env (defaults: 10 MB photo, 25 MB document) |

### Backend layout

```
backend/
├── cmd/api/          # Entrypoint; wires config, DB, handlers, middleware, static FS
├── internal/
│   ├── auth/         # JWT issue/parse, password hash, refresh store
│   ├── config/       # Load from env (port, DB, JWT, CORS, defaults)
│   ├── db/           # GORM connect, AutoMigrate, seed (admin, default dropdowns)
│   ├── handlers/     # HTTP handlers: auth, pets, vaccinations, weights, documents, photos, users, settings, options
│   ├── middleware/   # Auth (JWT/cookie), CORS, throttle (rate limit), logging
│   ├── models/       # GORM models (User, Pet, Vaccination, WeightEntry, Document, PetPhoto, etc.)
│   └── i18n/         # Server-side log message translation (optional)
```

- **Static files**: Frontend is built into `backend/cmd/api/static/` at Docker build time and served by the Go server for non-API routes (SPA fallback).
- **Uploads**: Photos and documents are stored on disk under `UPLOAD_DIR`; paths are stored in the database. Max file sizes are enforced (configurable via `MAX_UPLOAD_PHOTO_MB` and `MAX_UPLOAD_DOCUMENT_MB`).

## Frontend

| Layer | Technology | Notes |
|-------|------------|--------|
| Language | TypeScript | |
| Framework | React 19 | |
| Build | Vite 7 | Dev server, production build, code-splitting |
| Router | React Router 7 | Client-side routes |
| PWA | vite-plugin-pwa | Service worker, manifest, installability (PNG icons) |
| Charts | Recharts | Weight history and vaccination-related views |
| Icons | @iconify/react | UI icons |
| i18n | Custom context + JSON locales | en, es, fr, de |

### Frontend layout

```
frontend/
├── public/           # Static assets; icon-192.png, icon-512.png (generated), vite.svg
├── src/
│   ├── api/          # API client (fetch, auth, pets, vaccinations, weights, documents, photos, settings, etc.)
│   ├── components/   # Layout, Footer, InstallPrompt, ComboBox
│   ├── contexts/     # AuthContext, PWAInstallContext, I18n context
│   ├── data/         # Vaccination duration/expiry helpers
│   ├── i18n/         # Locales (en, es, fr, de), context
│   ├── lib/          # Logging, file type validation
│   ├── pages/        # Login, Dashboard, PetDetail, PetForm, Users, AdminDefaultOptions, Settings
│   └── utils/        # speciesEmoji, etc.
├── scripts/          # generate-pwa-icons.cjs (Sharp → PNG for PWA)
└── index.html
```

- **Auth**: Login returns user + access token; refresh uses httpOnly cookies. Client stores access token in memory and sends it in `Authorization` for API calls (and uploads) so mobile browsers that don’t send cookies still work.
- **PWA**: Manifest and service worker are generated by Vite PWA plugin; PNG icons are generated from SVG before build so the app is installable (standalone) on supported browsers.

## Deployment

- **Docker**: Single Dockerfile builds the frontend and copies it into the Go binary’s embed; `docker compose` runs the app and Postgres.
- **Volumes**: Database data, photo uploads, and document uploads are persisted via named volumes.
- **Env**: All configuration is via environment variables; see `docker-compose.sample.yml` and the main README.
